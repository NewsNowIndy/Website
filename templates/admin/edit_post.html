{% extends "admin/admin_base.html" %}
{% block title %}Admin — Edit Post{% endblock %}
{% block content %}
  <div class="card">
    <h1>Edit Post</h1>
    <form method="post">
      {{ form.csrf_token }}
      <div class="grid grid-2">
        <div>
          <label>Title</label>
          {{ form.title(class_="input") }}
        </div>
        <div>
          <label>Slug</label>
          {{ form.slug(class_="input") }}
        </div>
      </div>

      <label>Summary</label>
      {{ form.summary(class_="input") }}

      <label>Pick an existing hero image (optional)</label>
      <select class="input" name="hero_image_choice">
        <option value="">— Keep current —</option>
        {% for img in available_images %}
            <option value="{{ img }}" {% if post.hero_image_url == img %}selected{% endif %}>{{ img }}</option>
        {% endfor %}
        </select>

        <label>Upload hero image (optional)</label>
        {{ form.hero_file(class_="input") }}

        <label>Or external Hero Image URL</label>
        {{ form.hero_image_url(class_="input") }}

      <label>Content</label>
      {{ form.content(class_="input", id="editor") }}
      <div class="tiny-note">Use the toolbar to format text, insert links, images, video, and audio.</div>
      <label>{{ form.published() }} Published</label>

      <div style="margin-top:.6rem">
        <button class="btn btn-primary">Save Changes</button>
        <a class="btn" href="{{ url_for('admin_posts') }}">Cancel</a>
      </div>
    </form>
    {% if form.errors %}
        <div class="card" style="border-color:#ff6b6b">
            <strong>Couldn’t save — fix the fields below:</strong>
            <ul class="small">
            {% for field, errs in form.errors.items() %}
                {% for e in errs %}<li>{{ field }}: {{ e }}</li>{% endfor %}
            {% endfor %}
            </ul>
        </div>
    {% endif %}
  </div>

  <!-- TinyMCE WYSIWYG -->
  <script src="https://cdn.tiny.cloud/1/pymbkgkk2ngfeg388xhhwwqkpa65vaxzk5i7wr1zm4j08v0p/tinymce/8/tinymce.min.js" referrerpolicy="origin" crossorigin="anonymous"></script>
  <script>
    tinymce.init({
      selector: '#editor',
      height: 500,
      skin: 'oxide-dark',
      content_css: 'dark',
      menubar: false,
      plugins: 'link image media lists code table',
      toolbar: 'undo redo | styles | bold italic underline | alignleft aligncenter alignright | bullist numlist | link image media table | code',
      default_link_target: '_blank',
      link_assume_external_targets: 'https',
      setup: (editor) => {
        editor.on('change input undo redo', () => editor.save());
      }
    });
    // Add an id="edit-post-form" to the <form> tag, then:
    document.getElementById('create-post-form').addEventListener('submit', () => { if (window.tinymce) tinymce.triggerSave(); });
  </script>
  
{% endblock %}
